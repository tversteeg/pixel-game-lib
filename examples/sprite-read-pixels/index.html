<!doctype html><html lang=en><head><script integrity=sha384-pb++s6uBRKaQv+iAXpgA/H3IlpLZdO14tTwuCI7uXmz4aaZdByoCcM+6BhynMq/1 src=https://tversteeg.nl/chuot/js/theme.min.js></script><link href="https://tversteeg.nl/chuot/abridge.css?h=5737a518849fb7b8c7d7" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://tversteeg.nl/chuot name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link href=https://tversteeg.nl/chuot/manifest.min.json rel=manifest><link href=https://tversteeg.nl/chuot/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://tversteeg.nl/chuot/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link title="Chu·ªôt Atom/RSS Feed" href=https://tversteeg.nl/chuot/atom.xml rel=alternate type=application/atom+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title> Sprite Read Pixels | Chu·ªôt</title><meta content=Chu·ªôt name=copyright><meta content="Chu·ªôt is an AGPL licensed and opinionated game engine for 2D pixel-art games." name=description><link href=https://tversteeg.nl/chuot/examples/sprite-read-pixels/ rel=canonical><meta content="Rust, Game Engine, Chuot" name=keywords><meta content="Your Google Site verification code." name=google-site-verification><meta content="Your Bing Site verification code." name=msvalidate.01><meta content=https://tversteeg.nl/chuot/examples/sprite-read-pixels/ property=og:url><meta content=https://tversteeg.nl/chuot/examples/sprite-read-pixels/ name=twitter:url><meta content="Chu·ªôt is an AGPL licensed and opinionated game engine for 2D pixel-art games." property=og:description><meta content="Chu·ªôt is an AGPL licensed and opinionated game engine for 2D pixel-art games." name=twitter:description><meta content=" Sprite Read Pixels | Chu·ªôt" property=og:title><meta content=" Sprite Read Pixels | Chu·ªôt" name=twitter:title><meta content=summary_large_image name=twitter:card><meta content=https://tversteeg.nl/chuot/banner.png name=twitter:image><meta content=https://tversteeg.nl/chuot/banner.png property=og:image><meta content=Chu·ªôt property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2024-06-04 property=og:updated_time><meta content=@your-user-name name=twitter:site><meta content=@your-user-name name=twitter:creator><script src="https://tversteeg.nl/chuot/js/abridge_nosearch.min.js?h=d2e80da59ba55314230f" defer integrity=sha384-MJt+bD/MGhB0pUnCupc1HHXILLWQLG3AM/FJ0sPN/RUQPiCQD1ry9GiX4BsdA7+N></script><noscript><link href=https://tversteeg.nl/chuot/nojs.css rel=stylesheet></noscript><body><header><nav><div><h1><a href=https://tversteeg.nl/chuot title=Chu·ªôt>üê≠ Chu·ªôt</a></h1></div><div><div><ul><li><a class=s110 href=https://tversteeg.nl/chuot/examples/> Examples </a><li><a class=s110 href=https://docs.rs/chuot> Docs </a><li><a class=s110 href=https://github.com/tversteeg/chuot> Source </a><li><i class="js svgs adjust" id=mode type=reset></i></ul></div><div></div></div></nav></header><main><article><h1><a href=https://tversteeg.nl/chuot/examples/sprite-read-pixels/> Sprite Read Pixels</a></h1><p>Show how to read the pixels of a sprite.<p>Calling <code>ctx.sprite(..).read_pixels()</code> requires the <code>read-image</code> feature flag.<p>The sprite image for this example is:</p><img alt=Font height=100 loading=lazy src=https://tversteeg.nl/chuot/assets/threeforms.png width=100><p>With the following TOML:<pre class=language-toml data-lang=toml style=background:#fafafa;color:#61676c><code class=language-toml data-lang=toml><span>
</span><span style=color:#399ee6>offset </span><span>= </span><span style=color:#86b300>"Middle"
</span><span>
</span></code></pre><script type=module>
import init from "../../wasm/sprite_read_pixels.js";
window.addEventListener("load", () => {
  init();
});
</script><div style=width:720px;margin-left:auto;margin-right:auto><canvas id=chuot></canvas></div><p><a href=https://github.com/tversteeg/chuot/blob/main/examples/sprite_read_pixels.rs rel=noopener target=_blank>Source</a><pre class=language-rust data-lang=rust style=background:#fafafa;color:#61676c><code class=language-rust data-lang=rust><span style=color:#fa6e32>use </span><span>chuot</span><span style=color:#ed9366>::</span><span>{glamour</span><span style=color:#ed9366>::</span><span>Size2</span><span style=color:#61676ccc>,</span><span> Context</span><span style=color:#61676ccc>,</span><span> GameConfig</span><span style=color:#61676ccc>,</span><span> PixelGame}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=font-style:italic;color:#abb0b6>/// Which sprite to draw.
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>SPRITE</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str </span><span style=color:#ed9366>= </span><span style=color:#86b300>"threeforms"</span><span style=color:#61676ccc>;
</span><span>
</span><span style=font-style:italic;color:#abb0b6>/// Define a game state for our example.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>GameState </span><span>{
</span><span>    </span><span style=font-style:italic;color:#abb0b6>/// Pixel value underneath the mouse.
</span><span>    pixel</span><span style=color:#61676ccc>: </span><span style=font-style:italic;color:#55b4d4>Option</span><span><</span><span style=color:#fa6e32>u32</span><span>>,
</span><span>    </span><span style=font-style:italic;color:#abb0b6>/// Pixel values of the sprite.
</span><span>    </span><span style=font-style:italic;color:#abb0b6>///
</span><span>    </span><span style=font-style:italic;color:#abb0b6>/// Will be set once.
</span><span>    pixels</span><span style=color:#61676ccc>: </span><span style=font-style:italic;color:#55b4d4>Option</span><span><(Size2, </span><span style=font-style:italic;color:#55b4d4>Vec</span><span><</span><span style=color:#fa6e32>u32</span><span>>)>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span>PixelGame </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>GameState </span><span>{
</span><span>    </span><span style=font-style:italic;color:#abb0b6>/// Update the game.
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>update</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>ctx</span><span style=color:#61676ccc>:</span><span> Context) {
</span><span>        </span><span style=font-style:italic;color:#abb0b6>// Cache the pixels of the sprite once
</span><span>        </span><span style=color:#fa6e32>if </span><span style=font-style:italic;color:#55b4d4>self</span><span style=color:#ed9366>.</span><span>pixels</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_none</span><span>() {
</span><span>            </span><span style=font-style:italic;color:#55b4d4>self</span><span style=color:#ed9366>.</span><span>pixels </span><span style=color:#ed9366>= </span><span style=font-style:italic;color:#55b4d4>Some</span><span>(ctx</span><span style=color:#ed9366>.</span><span style=color:#f07171>sprite</span><span>(</span><span style=color:#ff8f40>SPRITE</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>read_pixels</span><span>())</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>
</span><span>        </span><span style=font-style:italic;color:#abb0b6>// Get the cached pixel values
</span><span>        </span><span style=color:#fa6e32>let </span><span style=font-style:italic;color:#55b4d4>Some</span><span>((sprite_size</span><span style=color:#61676ccc>,</span><span> pixels)) </span><span style=color:#ed9366>= &</span><span style=font-style:italic;color:#55b4d4>self</span><span style=color:#ed9366>.</span><span>pixels </span><span style=color:#fa6e32>else </span><span>{
</span><span>            </span><span style=color:#fa6e32>return</span><span style=color:#61676ccc>;
</span><span>        }</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=font-style:italic;color:#abb0b6>// Only do something when the mouse is on a pixel
</span><span>        </span><span style=color:#fa6e32>let </span><span style=font-style:italic;color:#55b4d4>Some</span><span>(mouse) </span><span style=color:#ed9366>=</span><span> ctx</span><span style=color:#ed9366>.</span><span style=color:#f07171>mouse</span><span>() </span><span style=color:#fa6e32>else </span><span>{ </span><span style=color:#fa6e32>return </span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=font-style:italic;color:#abb0b6>// Offset the mouse with the sprite in the middle of the screen
</span><span>        </span><span style=color:#fa6e32>let</span><span> mouse </span><span style=color:#ed9366>=</span><span> mouse </span><span style=color:#ed9366>-</span><span> ctx</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_vector</span><span>() </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0
</span><span>            </span><span style=font-style:italic;color:#abb0b6>// Also offset by half of the sprite itself since it's centered in the configuration
</span><span>            </span><span style=color:#ed9366>+</span><span> sprite_size</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_vector</span><span>() </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=font-style:italic;color:#abb0b6>// Convert the mouse coordinate to the pixel, ignoring when we don't hover over the image
</span><span>        </span><span style=font-style:italic;color:#55b4d4>self</span><span style=color:#ed9366>.</span><span>pixel </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> mouse</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>< </span><span style=color:#ff8f40>0.0
</span><span>            </span><span style=color:#ed9366>||</span><span> mouse</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>></span><span> sprite_size</span><span style=color:#ed9366>.</span><span>width
</span><span>            </span><span style=color:#ed9366>||</span><span> mouse</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>< </span><span style=color:#ff8f40>0.0
</span><span>            </span><span style=color:#ed9366>||</span><span> mouse</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>></span><span> sprite_size</span><span style=color:#ed9366>.</span><span>height
</span><span>        {
</span><span>            </span><span style=font-style:italic;color:#55b4d4>None
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            </span><span style=font-style:italic;color:#abb0b6>// Convert the mouse coordinates to the index inside the pixel data
</span><span>            </span><span style=color:#fa6e32>let</span><span> index </span><span style=color:#ed9366>=</span><span> mouse</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#ed9366>.</span><span style=color:#f07171>floor</span><span>() </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>usize </span><span style=color:#ed9366>+ </span><span>(mouse</span><span style=color:#ed9366>.</span><span>y</span><span style=color:#ed9366>.</span><span style=color:#f07171>floor</span><span>() </span><span style=color:#ed9366>*</span><span> sprite_size</span><span style=color:#ed9366>.</span><span>width) </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>usize</span><span style=color:#61676ccc>;
</span><span>
</span><span>            </span><span style=font-style:italic;color:#abb0b6>// Return the pixel value
</span><span>            </span><span style=font-style:italic;color:#55b4d4>Some</span><span>(pixels[index])
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=font-style:italic;color:#abb0b6>/// Render the game.
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>render</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>ctx</span><span style=color:#61676ccc>:</span><span> Context) {
</span><span>        </span><span style=font-style:italic;color:#abb0b6>// Draw the sprite
</span><span>        ctx</span><span style=color:#ed9366>.</span><span style=color:#f07171>sprite</span><span>(</span><span style=color:#ff8f40>SPRITE</span><span>)
</span><span>            </span><span style=font-style:italic;color:#abb0b6>// Place the sprite in the middle of the screen
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>translate</span><span>(ctx</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>() </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span>)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>draw</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=font-style:italic;color:#55b4d4>Some</span><span>(pixel) </span><span style=color:#ed9366>= </span><span style=font-style:italic;color:#55b4d4>self</span><span style=color:#ed9366>.</span><span>pixel {
</span><span>            </span><span style=font-style:italic;color:#abb0b6>// Draw the pixel value on the mouse
</span><span>            ctx</span><span style=color:#ed9366>.</span><span style=color:#f07171>text</span><span>(</span><span style=color:#86b300>"Beachball"</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{pixel:08X}</span><span style=color:#86b300>"</span><span>))
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>translate</span><span>(ctx</span><span style=color:#ed9366>.</span><span style=color:#f07171>mouse</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or_default</span><span>())
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>draw</span><span>()</span><span style=color:#61676ccc>;
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            </span><span style=font-style:italic;color:#abb0b6>// Notify the user to hover
</span><span>            ctx</span><span style=color:#ed9366>.</span><span style=color:#f07171>text</span><span>(</span><span style=color:#86b300>"Beachball"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"Hover the mouse</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>over the sprite"</span><span>)
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>translate</span><span>((</span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>2.0</span><span>))
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>draw</span><span>()</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span style=font-style:italic;color:#abb0b6>/// Open an empty window.
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>main</span><span>() {
</span><span>    </span><span style=font-style:italic;color:#abb0b6>// Game configuration
</span><span>    </span><span style=color:#fa6e32>let</span><span> config </span><span style=color:#ed9366>=</span><span> GameConfig {
</span><span>        buffer_size</span><span style=color:#61676ccc>: </span><span>Size2</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>240.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>192.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=font-style:italic;color:#abb0b6>// Apply a minimum of 3 times scaling for the buffer
</span><span>        </span><span style=font-style:italic;color:#abb0b6>// Will result in a minimum, and on web exact, window size of 720x576
</span><span>        scaling</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>3.0</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=font-style:italic;color:#55b4d4>Default</span><span style=color:#ed9366>::</span><span>default()
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=font-style:italic;color:#abb0b6>// Spawn the window and run the 'game'
</span><span>    GameState</span><span style=color:#ed9366>::</span><span>default()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>run</span><span>(chuot</span><span style=color:#ed9366>::</span><span>load_assets</span><span style=color:#ed9366>!</span><span>()</span><span style=color:#61676ccc>,</span><span> config)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>expect</span><span>(</span><span style=color:#86b300>"Error running game"</span><span>)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><nav><div><a href=https://tversteeg.nl/chuot/examples/render-interpolation/>‚Äπ Render Interpolation</a></div><div><a href=https://tversteeg.nl/chuot/examples/sprite-rotation/> Sprite Rotation ‚Ä∫</a></div></nav></article></main><footer><hr><div class=c><nav><div><a title="Chu·ªôt Atom/RSS Feed" href=https://tversteeg.nl/chuot/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="Chu·ªôt Atom/RSS Feed" type=Button></i></a><a href=https://github.com/tversteeg/chuot/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a></div></nav><nav><a class=s80 href=https://tversteeg.nl/chuot/sitemap.xml target=_blank> Sitemap </a></nav><p class=s70>Powered by <a href=https://www.getzola.org/ target=_blank>Zola</a> & <a href=https://github.com/Jieiku/abridge/ target=_blank>Abridge</a></div></footer>